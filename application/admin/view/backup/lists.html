<!DOCTYPE html>
<html class="x-admin-sm">
<head>
    {include file="common/head" /}
    <style>
        .layui-table-body {
            overflow-x: hidden;
        }
    </style>
</head>
<body>
<div class="x-nav">
          <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a href="">系统管理</a>
            <a>
              <cite>角色管理</cite></a>
          </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
</div>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">
                    <button class="layui-btn" id="backup">
                        <i class="layui-icon"></i>数据备份
                    </button>
                </div>
                <div class="layui-card-body ">
                    <table class="layui-table layui-form" id="demo" lay-filter="test"></table>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="__STATIC__/js/jquery-2.1.4.min.js"></script>
<script src="__STATIC__/js/common.js"></script>
<script>
    layui.use(['form', 'table'], function () {
        var form = layui.form;
        var table = layui.table;

        //执行渲染
        table.render({
            elem: '#demo'
            , url: 'get_file_list'
            , page: true
            , id: 'idTest'
            , cols: [[
                 {field: 'name', title: '文件名'}
                , {field: 'size', title: '文件大小'}
                , {field: 'time', title: '创建时间', sort: true}
                , {
                    field: 'right', title: '操作', templet: function (d) {
                        str = '<a href="javascript:;" title="下载" lay-event="download"><i class="layui-icon">&#xe601;</i></a>';
                        return str +
                            '<a href="javascript:;" title="还原" lay-event="restore"><i class="layui-icon">&#xe635;</i></a>' +
                            '<a href="javascript:;" title="删除" lay-event="delete"><i class="layui-icon">&#xe640;</i></a>';
                    }
                }
            ]]
            , done: function (res, curr, count) {
                //res:接口返回信息, curr:当前页码, count:数据总量
                if (count == 0) {
                    layer.msg('暂无相关信息');
                }
            }
        })

        //添加备份
        $('#backup').on('click',function () {
            var url = "{:url('backup/manipulate_data')}";
            var data = {
                'type':'backup',
            };
            _ajax_send(url, data, 'get');
        });

        //监听工具栏事件
        table.on('tool(test)', function (obj) {
            var obj_data = obj.data;
            console.log(obj_data);
            switch (obj.event) {
                case 'download':
                    var url = '/index.php/admin/backup/manipulate_data' + '?name=' + obj_data['name'] + '&type=download';
                    window.location.href = url;
                    break;
                case 'delete':
                    layer.confirm('确定要删除该备份吗?', {icon: 3, title: '确认操作'}, function (index) {
                        var url = "{:url('backup/manipulate_data')}";
                        var data = {
                            name: obj_data['name'],
                            type: 'delete',
                        };
                        _ajax_send(url, data, 'get');
                        layer.close(index); //关闭提示框
                    });
                    break;
                case 'restore':
                    layer.confirm('确定还原数据库吗?', {icon: 3, title: '确认操作'}, function (index) {
                        var url = "{:url('backup/manipulate_data')}";
                        var data = {
                            name: obj_data['name'],
                            type: 'restore',
                        }
                        _ajax_send(url, data, 'get');
                        layer.close(index); //关闭提示框
                    });
                    break;
            };
        });
    });
</script>
</html>